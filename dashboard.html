<!DOCTYPE html>
<meta name="viewport" content="width=device-width, initial-scale=1">
<head>
    <link rel="stylesheet" type="text/css" href="css/bulma"/>
    <link rel="stylesheet" type="text/css" href="css/custom"/>
</head>
<body>
    <div class="container-main">
      <div class="header">
        <a onclick="show_hide_navbar()" id="nav-logo">Tendermint Metrics</a>
        <div class="navbar">
          <a class="btn" href="/">Dashboard</a>
          <a class="btn" >Load</a>
          <a class="btn" href="/clean_cache">Delete</a>
        </div>
      </div>
    </div>  
    <div id="content-main"></div>    
</body>
<script>
    let i = 0;
        nav_status = ['grid','none'];
        show_hide_navbar = () => {
        document.getElementsByClassName("navbar")[0].style.display = nav_status[i%2];
        i++; 
    }   
</script>
<script>
    let data = {}
    let labels = []
    var content = document.getElementById("content-main");
            
    async function loadJson(){
        try {
            await fetch('http://localhost:3000/send_json').then(res => res.json()).then(json =>  data = json);
        }
        catch(er) {
            console.log(er);
        }
        
        for (var label in data) {
            labels.push(label);
        }

        for(var i=0; i<labels.length;i++){
            if (typeof(data[labels[i]])==='object') {
                var new_p = document.createElement("p");
                var new_p_text = document.createTextNode(labels[i]);
                new_p.appendChild(new_p_text);

                var new_ul = document.createElement("ul");
                for(label in data[labels[i]]){  
                    var new_li = document.createElement("li");
                    var new_li_text = document.createTextNode(label+" - "+data[labels[i]][label]);
                    new_li.appendChild(new_li_text);
                    new_ul.appendChild(new_li);
                }
                
                new_p.appendChild(new_ul);
                content.appendChild(new_p);
            } else {
                var new_p = document.createElement("p");
                var new_p_text = document.createTextNode(labels[i]+" "+data[labels[i]]);
                new_p.appendChild(new_p_text);
                content.appendChild(new_p);
            }
        }  
    } 
    loadJson();

</script>